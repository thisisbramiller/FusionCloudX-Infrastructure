# Optional Device Certificate Deployment

Guide for deploying FusionCloudX certificates to network devices (printers, appliances).

## Overview

This guide covers certificate deployment to **optional** network devices that are **NOT** part of core infrastructure. These devices require manual certificate import via their web interfaces.

### Included Devices

| Device | Type | IP Address | Certificate Format |
|--------|------|------------|-------------------|
| HP OfficeJet Pro 9015e | Network Printer | 192.168.40.226 | PFX |
| UniFi Dream Machine Pro | Network Appliance | 192.168.10.1 | PEM |
| UNAS Pro | Storage Appliance | 192.168.40.50 | PEM |

## Prerequisites

- 1Password CLI (`op`) installed and authenticated
- Access to FusionCloudX vault in 1Password
- Admin access to each device's web interface
- Certificates generated by bootstrap repository (Phase 04)

## Deployment Process

### Step 1: View Deployment Instructions

Run the optional device certificate playbook:

```bash
cd "FusionCloudX Infrastructure"
ansible-playbook ansible/playbooks/optional/deploy-device-certificates.yml
```

This displays:
- Device-specific deployment instructions
- 1Password retrieval commands
- Step-by-step manual import procedures

### Step 2: Download Certificates from 1Password

Use 1Password CLI to download certificates:

```bash
# HP OfficeJet Pro 9015e (PFX)
op document get 'HP OfficeJet Pro 9015e Certificate' \
  --vault 'FusionCloudX' \
  --output ~/Downloads/printer.pfx

# UniFi Dream Machine Pro (PEM)
op document get 'UDM Pro Certificate' \
  --vault 'FusionCloudX' \
  --output ~/Downloads/udm-pro.pem

# UNAS Pro (PEM)
op document get 'UNAS Pro Certificate' \
  --vault 'FusionCloudX' \
  --output ~/Downloads/nas01.pem
```

### Step 3: Import Certificates Manually

#### HP OfficeJet Pro 9015e

1. Navigate to `https://192.168.40.226`
2. Go to: **EWS** → **Network** → **Security** → **Certificates**
3. Select **Import Certificate and Private Key**
4. Upload `printer.pfx`
5. Password: (leave blank)
6. Apply configuration
7. Restart printer if prompted

#### UniFi Dream Machine Pro

1. Navigate to `https://192.168.10.1`
2. Go to: **Settings** → **System** → **Advanced** → **SSL Certificate**
3. Upload **Certificate** (PEM) and **Private Key**
4. Click **Apply Changes**
5. Controller will restart automatically

#### UNAS Pro

1. Navigate to `https://192.168.40.50`
2. Go to: **Settings** → **Security** → **Certificates**
3. Select **Import Server Certificate**
4. Upload certificate (PEM) and key (PEM)
5. Apply configuration
6. Restart UNAS if prompted

### Step 4: Verify Deployment

Test HTTPS access to each device:

```bash
# HP Printer
curl -I https://192.168.40.226

# UDM Pro
curl -I https://192.168.10.1

# UNAS Pro
curl -I https://192.168.40.50
```

Expected: Secure padlock in browser, no certificate warnings.

### Step 5: Clean Up Downloaded Certificates

**IMPORTANT:** Delete downloaded certificate files after import:

```bash
rm ~/Downloads/printer.pfx
rm ~/Downloads/udm-pro.pem
rm ~/Downloads/nas01.pem
```

## Troubleshooting

### Issue: "Device rejects certificate"

**Cause:** Certificate format incorrect or incomplete certificate chain

**Solution:**
- Verify correct format (PFX vs PEM) for device
- Check certificate includes full chain (Root CA + Intermediate CA + Server Cert)
- Re-download from 1Password

### Issue: "Cannot download from 1Password"

**Cause:** 1Password CLI not authenticated

**Solution:**
```bash
# Authenticate with 1Password
op signin

# Verify authentication
op vault list

# Retry download
```

### Issue: "Device still shows certificate warning"

**Cause:** Browser cached old certificate or Root CA not trusted

**Solution:**
- Clear browser cache and cookies
- Import Root CA to workstation (if not done in bootstrap Phase 13)
- Verify certificate CN matches device hostname

## Security Notes

- **Private keys are sensitive:** Delete downloaded PFX/PEM files after import
- **Use HTTPS only:** Never transmit certificates over HTTP
- **Rotate regularly:** Follow FusionCloudX certificate rotation policy
- **Monitor expiration:** Certificates generated with 10-year validity

## Adding New Devices

To add new network devices:

1. Edit `ansible/inventory/devices.yaml`
2. Add device entry with all required fields
3. Update 1Password with device-specific certificate
4. Run optional playbook to get instructions
5. Follow manual import procedure

## Integration with Core Infrastructure

**These devices are OPTIONAL** and separate from core infrastructure:

- **Core Infrastructure** (VMs): Automated via Ansible `certificates` role
- **Network Devices** (Optional): Manual deployment via this guide

See `ansible/roles/certificates/README.md` for core infrastructure certificate management.

---

**Last Updated:** 2026-01-28
**Related Files:**
- `ansible/inventory/devices.yaml` - Device inventory
- `ansible/playbooks/optional/deploy-device-certificates.yml` - Deployment playbook
- `ansible/roles/certificates/` - Core infrastructure certificates role
