---
services:
  tandoor:
    image: {{ tandoor_image }}
    container_name: tandoor
    restart: always
    volumes:
      - tandoor-static:/opt/recipes/staticfiles
      - tandoor-media:/opt/recipes/mediafiles
      - tandoor-socket:/tmp
    env_file:
      - .env

  nginx:
    image: nginx:mainline-alpine
    container_name: tandoor-nginx
    restart: always
    ports:
      - "{{ tandoor_https_port }}:443"
    depends_on:
      - tandoor
    volumes:
      - tandoor-static:/opt/recipes/staticfiles:ro
      - tandoor-media:/opt/recipes/mediafiles:ro
      - tandoor-socket:/tmp:ro
      - {{ tandoor_ssl_cert }}:/etc/nginx/ssl/server.crt:ro
      - {{ tandoor_ssl_key }}:/etc/nginx/ssl/server.key:ro
      - ./nginx.conf:/etc/nginx/conf.d/default.conf:ro

volumes:
  tandoor-static:
  tandoor-media:
  tandoor-socket:
