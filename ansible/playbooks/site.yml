---
# ==============================================================================
# Site Playbook - FusionCloudX Infrastructure
# ==============================================================================
# Main playbook that orchestrates all infrastructure configuration
# ==============================================================================

- name: FusionCloudX Infrastructure - Complete Deployment
  hosts: all
  gather_facts: yes

  tasks:
    - name: Display infrastructure overview
      debug:
        msg:
          - "========================================"
          - "FusionCloudX Infrastructure Deployment"
          - "========================================"
          - "Total hosts: {{ groups['all'] | length }}"
          - "PostgreSQL servers: {{ groups['postgresql'] | length if 'postgresql' in groups else 0 }}"
          - "Note: Single PostgreSQL instance hosts multiple databases"
          - "========================================"
      run_once: yes
      tags: ['always']

# ==============================================================================
# Common Infrastructure (Certificates, Base Configuration)
# ==============================================================================

- name: Deploy Common Infrastructure
  import_playbook: common.yml
  tags: ['common', 'certificates']

# ==============================================================================
# Database Server
# ==============================================================================

- name: Deploy PostgreSQL Database Server
  import_playbook: postgresql.yml
  tags: ['postgresql', 'databases']

# ==============================================================================
# Application Servers
# ==============================================================================

- name: Deploy GitLab
  import_playbook: gitlab.yml
  tags: ['gitlab', 'applications']

# ==============================================================================
# Monitoring (future)
# ==============================================================================

# - name: Deploy Monitoring Stack
#   import_playbook: monitoring.yml
#   tags: ['monitoring']
