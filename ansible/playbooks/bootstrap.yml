---
# ==============================================================================
# Bootstrap Playbook - LXC Container Prerequisites
# ==============================================================================
# Installs Ansible prerequisites (python3, sudo) on LXC containers using
# the raw module which works without Python pre-installed.
#
# Usage:
#   ansible-playbook playbooks/bootstrap.yml
#
# This playbook should run BEFORE any other playbooks targeting LXC containers.
# Standard Debian LXC templates don't include Python, so we use raw commands.
# ==============================================================================

- name: Bootstrap LXC Containers
  hosts: postgresql
  gather_facts: false
  become: true

  tasks:
    - name: Wait for container to be reachable
      wait_for_connection:
        timeout: 120

    - name: Install Ansible prerequisites (raw - no Python needed)
      raw: |
        apt-get update
        apt-get install -y python3 sudo
      changed_when: true

    - name: Gather facts after bootstrap
      setup:

    - name: Display bootstrap complete message
      debug:
        msg: "Bootstrap complete for {{ inventory_hostname }} - Python {{ ansible_python_version }}"
