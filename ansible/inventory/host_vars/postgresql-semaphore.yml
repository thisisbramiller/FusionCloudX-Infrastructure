---
# ==============================================================================
# Host Variables - postgresql-semaphore
# ==============================================================================
# PostgreSQL instance dedicated to Semaphore (Ansible UI)
# ==============================================================================

# Instance-specific PostgreSQL tuning
# Override group_vars settings for this 2GB RAM instance
postgresql_instance_config:
  shared_buffers: "512MB"  # ~25% of 2GB RAM
  effective_cache_size: "1536MB"  # ~75% of 2GB RAM
  work_mem: "8MB"
  maintenance_work_mem: "128MB"

# Database Configuration
postgresql_databases:
  - name: "semaphore"
    owner: "semaphore"
    encoding: "UTF-8"
    lc_collate: "en_US.UTF-8"
    lc_ctype: "en_US.UTF-8"
    template: "template0"

# Database Users
postgresql_users:
  - name: "semaphore"
    password: "{{ vault_semaphore_db_password }}"
    database: "semaphore"
    priv: "ALL"
    role_attr_flags: "CREATEDB,NOSUPERUSER,NOCREATEROLE"

# Firewall Rules (if using ufw)
postgresql_firewall_rules:
  - rule: "allow"
    port: "5432"
    proto: "tcp"
    from_ip: "192.168.0.0/16"  # Allow from local network
    comment: "PostgreSQL for Semaphore"

# Backup Configuration (for future implementation)
postgresql_backup_enabled: true
postgresql_backup_retention_days: 7
